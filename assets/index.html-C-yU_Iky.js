import{_ as e,c as p,a,b as n,f as l,d as t,r as i,o as r}from"./app-CJfFg5nr.js";const c={};function d(B,s){const o=i("font");return r(),p("div",null,[s[5]||(s[5]=a(`<p><a href="https://www.mongodb.com/docs/manual/" target="_blank" rel="noopener noreferrer">官方文档</a></p><h1 id="lookup-中的-localfield-不能使用" tabindex="-1"><a class="header-anchor" href="#lookup-中的-localfield-不能使用"><span>$lookup 中的 localField 不能使用 $</span></a></h1><p>$lookup 一般用于集合之间的连接查询，其语法如下</p><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#FFFFFF;">   $lookup</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">     {</span></span>
<span class="line"><span style="color:#FFFFFF;">       from</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;要连接的集合&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#FFFFFF;">       localField</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;当前文档的字段&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#FFFFFF;">       foreignField</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;要连接集合的主键&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#FFFFFF;">       as</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;输出字段名称, 这里将会输出为数组类型&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">     }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但是如果当前文档要进行连接的字段类型是 DBRef, 那么就不能在 localField 直接写 a.$id, 会出现以下错误</p><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">assert: command failed:</span></span>
<span class="line"><span style="color:#ABB2BF;">{ </span><span style="color:#E06C75;">&quot;ok&quot;</span><span style="color:#ABB2BF;"> : </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">&quot;errmsg&quot;</span><span style="color:#ABB2BF;"> : </span><span style="color:#98C379;">&quot;FieldPath field names may not start with &#39;$&#39;.&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">&quot;code&quot;</span><span style="color:#ABB2BF;"> : </span><span style="color:#D19A66;">16410</span><span style="color:#ABB2BF;"> }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>原因是管道函数中限制了 fieldName 不能以 $ 开始, 所以此处会报错。解决办法：在 lookup 前加入下面管道代码生成一个去掉 $ 的 field</p><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#FFFFFF;">        $addFields</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">            &quot;taskNos&quot;</span><span style="color:#ABB2BF;">: </span></span>
<span class="line"><span style="color:#ABB2BF;">            {</span></span>
<span class="line"><span style="color:#FFFFFF;">                $arrayToObject</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#FFFFFF;">                    $map</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#FFFFFF;">                        input</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#FFFFFF;">                            $objectToArray</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;$taskNos&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">                        },</span></span>
<span class="line"><span style="color:#FFFFFF;">                        in</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#FFFFFF;">                            k</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#FFFFFF;">                                $cond</span><span style="color:#ABB2BF;">: [</span></span>
<span class="line"><span style="color:#ABB2BF;">                                    {</span></span>
<span class="line"><span style="color:#FFFFFF;">                                        $eq</span><span style="color:#ABB2BF;">: [{</span></span>
<span class="line"><span style="color:#E06C75;">                                            &quot;$substrCP&quot;</span><span style="color:#ABB2BF;">: [</span><span style="color:#98C379;">&quot;$$this.k&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">                                        }, {</span></span>
<span class="line"><span style="color:#FFFFFF;">                                            $literal</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;$&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">                                        }]</span></span>
<span class="line"><span style="color:#ABB2BF;">                                    },</span></span>
<span class="line"><span style="color:#ABB2BF;">                                    {</span></span>
<span class="line"><span style="color:#FFFFFF;">                                        $substrCP</span><span style="color:#ABB2BF;">: [</span><span style="color:#98C379;">&quot;$$this.k&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, {</span></span>
<span class="line"><span style="color:#FFFFFF;">                                            $strLenCP</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;$$this.k&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">                                        }]</span></span>
<span class="line"><span style="color:#ABB2BF;">                                    },</span></span>
<span class="line"><span style="color:#98C379;">                                    &quot;$$this.k&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">                                ]</span></span>
<span class="line"><span style="color:#ABB2BF;">                            },</span></span>
<span class="line"><span style="color:#FFFFFF;">                            v</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;$$this.v&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">                        }</span></span>
<span class="line"><span style="color:#ABB2BF;">                    }</span></span>
<span class="line"><span style="color:#ABB2BF;">                }</span></span>
<span class="line"><span style="color:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="mongotemplate-组合任意查询语句" tabindex="-1"><a class="header-anchor" href="#mongotemplate-组合任意查询语句"><span>MongoTemplate 组合任意查询语句</span></a></h1><p>可以使用通用 api 进行任意创建</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#E5C07B;"> org.springframework.data.mongodb.MongoExpression</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E5C07B;"> org.bson.Document</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// 这里的表达式是不需要加 { } 的</span></span>
<span class="line"><span style="color:#E5C07B;">AggregationExpression</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">from</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">MongoExpression</span></span>
<span class="line"><span style="color:#ABB2BF;">                           .</span><span style="color:#61AFEF;">create</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;k: {$cond: [{$eq: [{</span><span style="color:#56B6C2;">\\&quot;</span><span style="color:#98C379;">$substrCP</span><span style="color:#56B6C2;">\\&quot;</span><span style="color:#98C379;">: [</span><span style="color:#56B6C2;">\\&quot;</span><span style="color:#98C379;">$$taskNo.k</span><span style="color:#56B6C2;">\\&quot;</span><span style="color:#98C379;">, 0, 1] }, {$literal: </span><span style="color:#56B6C2;">\\&quot;</span><span style="color:#98C379;">$</span><span style="color:#56B6C2;">\\&quot;</span><span style="color:#98C379;">}] }, {$substrCP: [</span><span style="color:#56B6C2;">\\&quot;</span><span style="color:#98C379;">$$taskNo.k</span><span style="color:#56B6C2;">\\&quot;</span><span style="color:#98C379;">, 1, {$strLenCP: </span><span style="color:#56B6C2;">\\&quot;</span><span style="color:#98C379;">$$taskNo.k</span><span style="color:#56B6C2;">\\&quot;</span><span style="color:#98C379;">}] }, </span><span style="color:#56B6C2;">\\&quot;</span><span style="color:#98C379;">$$taskNo.k</span><span style="color:#56B6C2;">\\&quot;</span><span style="color:#98C379;">] }, v: </span><span style="color:#56B6C2;">\\&quot;</span><span style="color:#98C379;">$$taskNo.v</span><span style="color:#56B6C2;">\\&quot;</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">))</span><span style="color:#E06C75;">))</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// 如果是要加 k: v 这种 map 形式的表达式, 则可以使用 Document</span></span>
<span class="line"><span style="color:#E06C75;">doc </span><span style="color:#C678DD;">-&gt;</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> Document</span><span style="color:#E06C75;">()</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;appName&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;$$app.k&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;appValue&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;$$app.v&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="windows-下-mongodb-安装" tabindex="-1"><a class="header-anchor" href="#windows-下-mongodb-安装"><span>Windows 下 MongoDB 安装</span></a></h1>`,12)),n("ol",null,[n("li",null,[s[0]||(s[0]=l("首先去")),t(o,{style:{color:"#2F4BDA"}}),s[1]||(s[1]=n("a",{href:"https://www.mongodb.com/try/download/community",target:"_blank",rel:"noopener noreferrer"},"官网",-1)),s[2]||(s[2]=l(" 选择版本后下载二进制包"))]),s[3]||(s[3]=n("li",null,"解压到安装目录，然后在 mongo 的根目录下创建 data、logs 两个文件夹",-1)),s[4]||(s[4]=n("li",null,"在 mongo 的根目录下创建 mongo.cfg文件然后写入以下内容",-1))]),s[6]||(s[6]=a(`<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">systemLog:</span></span>
<span class="line"><span style="color:#ABB2BF;">  destination: file</span></span>
<span class="line"><span style="color:#ABB2BF;">  logAppend: </span><span style="color:#D19A66;">true</span></span>
<span class="line"><span style="color:#ABB2BF;">  path: xxx/logs/mongo.log</span></span>
<span class="line"><span style="color:#ABB2BF;">storage:</span></span>
<span class="line"><span style="color:#ABB2BF;">  dbPath: xxx/data</span></span>
<span class="line"><span style="color:#ABB2BF;">  journal:</span></span>
<span class="line"><span style="color:#ABB2BF;">    enabled: </span><span style="color:#D19A66;">true</span></span>
<span class="line"><span style="color:#ABB2BF;">  wiredTiger:</span></span>
<span class="line"><span style="color:#ABB2BF;">    engineConfig:</span></span>
<span class="line"><span style="color:#ABB2BF;">      cacheSizeGB: </span><span style="color:#D19A66;">1</span></span>
<span class="line"><span style="color:#ABB2BF;">net:</span></span>
<span class="line"><span style="color:#ABB2BF;">  port: </span><span style="color:#D19A66;">27000</span></span>
<span class="line"><span style="color:#ABB2BF;">  bindIp: </span><span style="color:#D19A66;">0.0</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">0.0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>使用管理员权限打开终端（如果是 PowerShell 则需要允许执行脚本，建议使用 cmd）执行以下命令 mongod.exe --config &quot;xxx/mongo.cfg&quot; --install（默认安装的服务名为 MongoDB 如果没有此服务名可以去日志目录下查看日志信息）</li><li>win + r 执行 services.msc 找到服务名并启动</li><li>键入 mongo.exe 可查看是否启动成功</li></ol>`,2))])}const F=e(c,[["render",d],["__file","index.html.vue"]]),y=JSON.parse('{"path":"/article/tm7k59or/","title":"mongodb","lang":"zh-CN","frontmatter":{"title":"mongodb","tags":["mongodb","database"],"createTime":"2025/02/25 21:38:22","permalink":"/article/tm7k59or/","description":"官方文档 $lookup 中的 localField 不能使用 $ $lookup 一般用于集合之间的连接查询，其语法如下 但是如果当前文档要进行连接的字段类型是 DBRef, 那么就不能在 localField 直接写 a.$id, 会出现以下错误 原因是管道函数中限制了 fieldName 不能以 $ 开始, 所以此处会报错。解决办法：在 look...","head":[["meta",{"property":"og:url","content":"https://upcloudrabbit.github.io/blog/blog/article/tm7k59or/"}],["meta",{"property":"og:site_name","content":"upcloudrabbit blog"}],["meta",{"property":"og:title","content":"mongodb"}],["meta",{"property":"og:description","content":"官方文档 $lookup 中的 localField 不能使用 $ $lookup 一般用于集合之间的连接查询，其语法如下 但是如果当前文档要进行连接的字段类型是 DBRef, 那么就不能在 localField 直接写 a.$id, 会出现以下错误 原因是管道函数中限制了 fieldName 不能以 $ 开始, 所以此处会报错。解决办法：在 look..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-02-25T13:57:05.000Z"}],["meta",{"property":"article:tag","content":"mongodb"}],["meta",{"property":"article:tag","content":"database"}],["meta",{"property":"article:modified_time","content":"2025-02-25T13:57:05.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"mongodb\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-02-25T13:57:05.000Z\\",\\"author\\":[]}"]]},"headers":[],"readingTime":{"minutes":1.69,"words":506},"git":{"updatedTime":1740491825000,"contributors":[{"name":"upcloudrabbit","username":"upcloudrabbit","email":"1814876440@qq.com","commits":1,"avatar":"https://avatars.githubusercontent.com/upcloudrabbit?v=4","url":"https://github.com/upcloudrabbit"}]},"autoDesc":true,"filePathRelative":"db/mongodb.md","categoryList":[{"id":"d77d5e","sort":10002,"name":"db"}]}');export{F as comp,y as data};
